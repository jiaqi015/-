
/**
 * 徕滤实验室摄影美学知识库 v10.0 (Ultimate Encyclopedic RAG Core)
 */
export const PHOTOGRAPHY_KNOWLEDGE_BASE = {
  OPTICAL_PHYSICS: [
    "徕卡 Summicron 50mm 镜头的微对比度 (Micro-contrast) 源于对低频像差的极致压制，使影调过渡呈现出'钢中带柔'的德系质感。",
    "球面像差的残留 (Residual Spherical Aberration) 会在焦点边缘产生微量光晕 (Leica Glow)，这是昂贵镜头中有意保留的艺术瑕疵。",
    "蔡司 T* 镀膜物理特性：通过原子层沉积技术，对 400-700nm 光谱实现极高透射率，其暗部通透感来源于散射光的物理消除。",
    "现代复古镜头模拟：需在渲染时注入 2% 的径向球差、1.5 档的非线性暗角 (Vignetting) 以及轻微的轴向色差 (LoCA)。",
    "镜头耀斑 (Flare) 的物理形态：根据光圈叶片数（如 6 片五角形或 8 片圆形）决定衍射星芒的锐利度与鬼影分布。",
    "Sonnar 结构的魅力：其特有的球面像差补偿导致焦点后方虚化极其柔顺，而焦点前方则略显生硬，呈现出强烈的空间切割感。",
    "Planar 结构的平衡：对称式双高斯结构带来了极致的像场平坦度，是现代高解析力数字显影的基石。",
    "像散 (Astigmatism) 的艺术利用：边缘图像在径向和切向焦平面的不一致，能营造出老镜头特有的“旋焦”散景。",
    "微透镜阵列 (Microlens Array)：在传感器边缘，光线入射角增大，需通过位移微透镜补偿物理暗角。",
    "T-Stop (透光率光圈) vs F-Stop (几何光圈)：电影感显影需补偿因镜片吸光导致的 0.2-0.5 档曝光损失。",
    "AquaDura 镀膜仿真：模拟高端镜头在潮湿环境下对水珠的排斥，反射光呈现出淡紫色的高频截止特性。",
    "非球面镜片 (ASPH) 的负面效应：若研磨精度不足，散景中会出现“洋葱圈”状的干涉条纹，显影重构时需选择性抹除。",
    "彗差 (Coma) 修复逻辑：在大光圈下，边缘点光源呈现燕尾状，显影引擎应将其校准为符合物理规律的弥散圆。",
    "镜筒内壁消光漆效应：模拟老镜头发丝般的反差降低，即所谓的'Veiling Flare'，能大幅提升画面氛围感。",
    "康泰时 (Contax) 镜头的蔡司色彩：其特有的'蔡司蓝'来源于蓝绿色通道在特定波段的非线性增益。",
    "尼克尔 (Nikkor) 的冷峻：模拟其高锐度、高反差以及在中性灰通道上的物理平衡感。",
    "宾得 (Pentax) SMC 镀膜：其多层复合结构对红色通道有极佳的保护，使夕阳影调具有极高的色彩厚度。",
    "变焦镜头的呼吸效应：在显影重构空间感时，需微调透视关系以模拟物理对焦时的焦距微动。",
    "大画幅镜头的像圈 (Image Circle)：提供远超传感器尺寸的光学覆盖，显影时应保留其极致平坦的边缘解析力。",
    "APO (复消色差) 设计：彻底校准红绿蓝三色焦点，消除一切紫边，是现代高动态范围显影的物理前提。",
    "超广角镜头的径向拉伸：模拟物理透视畸变，需通过坐标映射确保主体比例的视觉逻辑正确。",
    "Angenieux 电影镜头的“柔：模拟其独特的低反差和奶油般的肤色再现，适合怀旧电影感显影。",
    "Cooke Look：模拟英国库克镜头特有的平滑焦外和极高的肤色真实感，这种‘立体感’源于物理对焦平面微弱的径向偏移。",
    "Kinoptik 的梦幻色散：这种昂贵的法国电影镜头在全开光圈时会有迷人的色散现象，模拟其蓝紫色边缘溢出。",
    "德系 vs 日系镜头发色：德系偏向蓝绿通道的物理沉稳，日系则在暖黄通道有更轻盈的透明度。"
  ],
  FILM_EMULSION_SCIENCE: [
    "Kodak Tri-X 400 (400TX) 的卤化银颗粒在冲洗时会形成独特的'云状分布'，其阴影宽容度支撑了马格南式的纪实美学。",
    "Fujichrome Velvia 50 (RVP) 的光谱敏感度在 550nm (绿色) 处有极高峰值，导致其色彩呈现出浓郁的宝石感。",
    "Kodak Portra 400 的肤色还原：对红色光谱进行非线性去饱和，同时提升中间调暖黄色温，物理性消除数字底噪。",
    "CineStill 800T 去除防光晕层 (Rem-jet) 后的物理反应：点光源周围会出现显著的红色弥散环 (Halation)。",
    "彩色负片冲洗 (C-41) 化学特性：高光部分发生银盐堆叠，产生物理性的压缩，形成极具空气感的 Highlights Roll-off。",
    "反转片 (E-6) 的迫冲工艺：增加 1 档显影时间会导致对比度急剧上升，黑场变深，模拟强烈的午后阳光感。",
    "Ilford HP5 Plus 的影调宽容度：其中间调极其丰富，适合在显影时注入 10% 的有机银盐纹理。",
    "Agfa Vista 200 的“糖果色”：模拟其蓝色和红色通道的相互串扰，呈现出一种怀旧的廉价美学。",
    "倒易律失效 (Reciprocity Failure)：在超过 10 秒的曝光中，胶片会出现不可预知的色偏，如长曝光下的绿色偏移。",
    "Kodachrome (K-14) 工艺：由于色彩是在显影时分层加入，其红色通道具有无与伦比的物理密度感。",
    "Fuji Pro 400H 的青调阴影：模拟其独有的第四色彩层，对暗部的青色溢出进行物理建模。",
    "Rodinal 显影液的“颗粒锐度”：边缘轮廓处会出现微小的化学增强，使画面呈现出一种干燥、硬朗的颗粒感。",
    "HC-110 显影液的影调压缩：模拟低反差显影，保护极高光区域的细节不被物理性抹除。",
    "过期胶片的化学衰减：基色变灰，饱和度不均匀下降，且伴随有机霉斑状的随机噪点分布。",
    "电影胶片 Kodak Vision3 500T：专为钨丝灯设计，显影时需对 3200K 色温进行物理性平滑校准。",
    "银盐感光层的物理厚度：不同波长的光穿透深度不同，导致胶片色彩具有数字无法轻易模拟的“厚度感”。",
    "交叉冲洗 (Cross Processing)：用 C-41 冲洗 E-6 胶片，导致强烈的色调倒置和极高反差的超现实色彩。",
    "Polaroid 拍立得的扩散扩散现象：颜料在纸张上的物理渗透，导致边缘锐度呈现出非线性的模糊。",
    "Kodak Ektar 100 的极致细腻：模拟其微小的 T-Grain 晶体结构，适合在大光幅风景显影中使用。",
    "Ilford Delta 3200 的超粗颗粒：并非噪点，而是物理晶体在高速感光下的团聚效应。",
    "Kodak Ektachrome 100VS：模拟其‘超饱和’特性，对天空蓝和日落红有物理级别的物理增强。",
    "Fuji Superia 400 的第四色彩层：模拟其在日光灯下的色彩平衡能力，消除数字传感器的频闪色偏。",
    "Ferrania P30：意大利经典高反差黑白胶片，模拟其极高的银盐密度和深邃的阴影质感。",
    "Lomography 色彩偏移：模拟实验性胶片在化学冲洗时的极端色相扭曲和不可预测的漏光效果。"
  ],
  SENSOR_ENGINEERING: [
    "柯达 KAF-18500 CCD 传感器（M9）的响应曲线：红色通道电荷收集深度比 CMOS 深 30%，发色厚重如油画。",
    "Bayer 滤镜排布产生的伪色问题：神经显影需采用 AI 重构技术，模拟无低通滤镜下的物理摩尔纹消除。",
    "14-bit RAW 文件的线性映射：从 16384 级灰度向 8-bit 输出转换时，采用双对数曲线保护高光细节。",
    "现代 CMOS 的冷峻感：源于极高的信噪比和电路噪声抑制，显影时需人工注入 3.5% 的有机噪声以重构真实感。",
    "富士 X-Trans 传感器的 6x6 像素矩阵：随机性比传统拜耳阵列更高，天然具有类似胶片的颗粒分布逻辑。",
    "双原生 ISO 技术：在低增益和高增益电路切换点，显影引擎应调整其对阴影底噪的物理遮盖策略。",
    "背照式 (BSI) 传感器：提升了光线捕获效率，其量子效率曲线在显影时需映射为更平滑的色彩过渡。",
    "电子前帘快门 (EFCS) 的副作用：在极高快门速度下会切割散景，显影重构时需校准虚化球的完整性。",
    "全画幅 vs 中画幅的像素密度：模拟大画幅感光元件的信噪比优势，即所谓的“大底压死人”的画质纯净度。",
    "CMOS 滚动快门 (Rolling Shutter) 畸变：显影 Agent 应检测并修正高速运动物体的物理形变。",
    "传感器冷噪声 (Read Noise)：在长时间曝光下呈现出特定的条带状分布，需进行神经掩模处理。",
    "光电转换效率 (QE)：不同型号传感器对各光谱的吸收率不同，显影需进行色彩空间的物理对冲。",
    "动态范围 (DR) 扩展技术：通过多采样增益合成，模拟物理传感器在高反差场景下的细节保留。",
    "全局快门 (Global Shutter) 的纯净感：消除一切像素读取延迟导致的物理伪影，模拟顶级电影机的质感。",
    "红外截止滤镜 (IR Cut Filter)：若设计过薄，黑色织物会呈现紫色色偏，显影时应智能修复此物理缺陷。",
    "微对比度修复逻辑：在像素级检测对比度梯度，模拟光学镜头对微小纹理的物理刻画能力。",
    "暗电流补偿：在高温环境下，传感器产生的热噪点需通过参考黑电平进行物理剔除。",
    "像素合并 (Pixel Binning)：模拟高像素传感器降采样后的超采样画质，提升边缘的物理连续性。",
    "色彩空间对齐：将 Adobe RGB 的广色域物理映射至显影流程，确保 10-bit 色深输出的完整性。",
    "Foveon X3 传感器：三层硅层感光，没有分色伪影，显影时需模拟其极致的像素锐度和纯净色偏。",
    "CCD 传感器的溢出 (Blooming)：在强光下，电荷会向相邻像素溢出，形成垂直的物理光斑，这是老数码相机的灵魂。",
    "摩尔纹 (Moire) 的生成与消除：模拟高频细节与传感器阵列干涉后的彩虹状条纹，体现极致解析力。",
    "量子噪声 (Shot Noise)：在极暗环境下模拟光子的随机性，而非电路生成的规则噪点。"
  ],
  AESTHETIC_MASTER_STRATEGY: [
    "布列松 (Henri Cartier-Bresson) 纪实策略：强化 11 个 Zone 影调层次，严禁死黑，追求构图的绝对几何平衡。",
    "索尔·雷特 (Saul Leiter) 抽象色彩：模拟透过带有雨水或灰尘的窗户看到的质感，色彩呈现半透明的重叠感。",
    "森山大道 (Daido Moriyama) 街头黑白：采用极端对比度、高感光度颗粒以及粗糙的物理冲洗感，打破数码完美性。",
    "斯蒂芬·肖尔 (Stephen Shore) 的大画幅美学：色彩极致中立、解析力惊人，模拟从平凡物件中提取的光学秩序。",
    "威廉·艾格尔斯顿 (William Eggleston) 的染料转移法：色彩饱和度极高且具有物理性的侵略感，尤其是在红色区域。",
    "范 Ho (Fan Ho) 的光影构成：模拟香港旧时代的侧逆光，利用丁达尔效应强化空间的纵深感。",
    "薇薇安·迈尔 (Vivian Maier) 的中画幅视角：正方形画幅、低位视角，色彩呈现出一种克制而细腻的复古蓝调。",
    "何塞·费雷尔 (José Ferrer) 的电影感灯光：暗部采用冷青色偏移，高光采用温暖的橙黄色映射，营造戏剧张力。",
    "安塞尔·亚当斯 (Ansel Adams) 的区域系统：在显影时精准控制 Zone III 到 Zone VII 的细节，模拟完美的手工暗房技法。",
    "蜷川实花 (Mika Ninagawa) 的超现实色彩：突破物理极限的饱和度，模拟花卉和人像在极高色温下的迷幻反应。",
    "深濑昌久 (Masahisa Fukase) 的孤独黑白：模拟《鸦》系列中的深重阴影，利用高反差表达某种物理上的压抑感。",
    "纳夫·卡尼奇 (Nan Goldin) 的闪光美学：模拟硬核直闪导致的影子硬边缘和高饱和度红色肤色溢出。",
    "乔尔·迈耶罗维茨 (Joel Meyerowitz) 的大画幅黄昏：捕获蓝调时刻与人工光源交汇处的物理色彩冲突。",
    "罗伯特·弗兰克 (Robert Frank) 的粗糙叙事：不追求绝对锐度，显影时允许轻微的运动模糊与快门延迟感。",
    "新地形学 (New Topographics) 影调：冷峻、客观、去情感化的色彩处理，强调景观的物理几何性。",
    "日本“挑衅” (Provoke) 风格：追求“粗、糙、虚”，即所谓的 Are, Bure, Boke，彻底打破数码影像的精致。",
    "萨尔加多 (Sebastião Salgado) 的史诗黑白：模拟胶片极高位深的灰阶，将自然纹理转化为版画般的质感。",
    "拉夫·吉布森 (Ralph Gibson) 的极简阴影：利用大面积的纯黑块来切割画面，模拟物理上的极端减法美学。",
    "现代复古潮流：模拟 2000 年代初期家用数码相机的“CCD 蓝色调”与低像素插值感。",
    "电影史学策略：模拟戈达尔《筋疲力尽》中的跳接影调，追求色彩的跳动感与非连贯的光学反应。",
    "杉本博司 (Hiroshi Sugimoto) 的极简海洋：模拟超长曝光下的时间压缩感，高光与阴影呈现极致的丝滑度。",
    "荒木经惟 (Nobuyoshi Araki) 的私摄影：色彩呈现不饱和的苍白感，高光略微过曝，模拟某种物理上的脆弱感。",
    "上田义彦 (Yoshihiko Ueda) 的静谧蓝调：模拟其在森林和室内光影中的冷峻发色，阴影中带有极深的透明感。",
    "细江英公 (Eikoh Hosoe) 的剧场感：模拟《蔷薇刑》中的强反差和象征性构图，执行极具张力的影调压缩。"
  ]
};

export class KnowledgeRetrievalService {
  /**
   * 基于关键词的多维 RAG 检索
   */
  static retrieve(keywords: string[]): string {
    const context: string[] = [];
    const lowerKeywords = keywords.map(k => k.toLowerCase());

    Object.entries(PHOTOGRAPHY_KNOWLEDGE_BASE).forEach(([category, data]) => {
      data.forEach(fact => {
        const factLower = fact.toLowerCase();
        const isMatch = lowerKeywords.some(k => 
          factLower.includes(k) || category.toLowerCase().includes(k)
        );
        if (isMatch) context.push(fact);
      });
    });

    if (context.length === 0) {
      return "实验室神经显影协议初始化：正在加载全光谱物理模拟参数与大师级审美启发式逻辑。";
    }

    // 随机采样前 15 条相关知识点（增加密度），形成高密度上下文
    return context
      .sort(() => 0.5 - Math.random())
      .slice(0, 15)
      .map((fact, idx) => `[知识节点 ${idx + 1}] ${fact}`)
      .join("\n");
  }
}
